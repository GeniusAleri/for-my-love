<!doctype html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lempar Dadu Cinta — 20 Oktober 💜</title>
  <style>
    :root {
      --bg1: #4b1979;
      --bg2: #7b4dbb;
      --accent: #ffd1ea;
      --glass: rgba(255, 255, 255, 0.06);
      --glass-2: rgba(255, 255, 255, 0.03);
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(160deg, var(--bg1) 0%, var(--bg2) 100%);
      color: #fff;
      overflow-y: auto;
    }

    .wrap {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 28px;
      gap: 18px;
      text-align: center;
    }

    /* Intro */
    .intro {
      background: var(--glass);
      padding: 14px 18px;
      border-radius: 14px;
      backdrop-filter: blur(6px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.28);
      max-width: 840px;
      width: 100%;
      transform-origin: center;
      animation: introIn .7s ease;
    }

    @keyframes introIn {
      from {
        opacity: 0;
        transform: translateY(8px)
      }

      to {
        opacity: 1;
        transform: none
      }
    }

    .intro h1 {
      margin: 0 0 6px 0;
      font-size: clamp(18px, 3.2vw, 28px);
    }

    .intro p {
      margin: 0;
      font-size: clamp(13px, 2.2vw, 16px);
      opacity: 0.95;
    }

    /* stage */
    .stage {
      width: 100%;
      max-width: 640px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: center;
    }

    .dice-wrap {
      width: clamp(160px, 36vw, 260px);
      height: clamp(160px, 36vw, 260px);
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1200px;
      position: relative;
      margin: 8px 0;
    }

    .dice {
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.10), rgba(255, 255, 255, 0.03));
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
      font-weight: 800;
      font-size: clamp(48px, 10vw, 96px);
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.45), inset 0 -6px 18px rgba(0, 0, 0, 0.12);
      transform-style: preserve-3d;
      user-select: none;
      transition: transform 900ms cubic-bezier(.2, .9, .2, 1);
    }

    .dice.rolling {
      animation: diceSpin 0.85s ease-in-out;
    }

    @keyframes diceSpin {
      0% {
        transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(1);
      }

      25% {
        transform: rotateX(320deg) rotateY(140deg) rotateZ(25deg) scale(1.02);
      }

      50% {
        transform: rotateX(640deg) rotateY(360deg) rotateZ(-25deg) scale(1.03);
      }

      75% {
        transform: rotateX(920deg) rotateY(580deg) rotateZ(10deg) scale(1.01);
      }

      100% {
        transform: rotateX(1080deg) rotateY(720deg) rotateZ(0deg) scale(1);
      }
    }

    /* roll button */
    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    button.roll-btn {
      background: linear-gradient(180deg, #fff, #ffe6ff);
      color: #6a2ca9;
      border: none;
      padding: 12px 26px;
      border-radius: 999px;
      font-weight: 700;
      font-size: clamp(14px, 2.6vw, 18px);
      cursor: pointer;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.25);
      transition: transform .18s ease, box-shadow .18s ease, opacity .18s;
    }

    button.roll-btn:active {
      transform: translateY(2px) scale(.997)
    }

    button.roll-btn[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none
    }

    .caption {
      font-size: clamp(13px, 2.2vw, 15px);
      opacity: 0.95;
      color: #ffe6fb;
    }

    /* results */
    .results-box {
      width: 100%;
      max-width: 540px;
      background: linear-gradient(180deg, var(--glass-2), transparent);
      border-radius: 12px;
      padding: 12px 14px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.22);
      text-align: center;
    }

    .results-list {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .result-item {
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      font-weight: 700;
      background: rgba(255, 255, 255, 0.06);
      padding: 8px 12px;
      font-size: 18px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.16);
    }

    .final-msg {
      margin-top: 12px;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .8s ease, transform .8s ease;
      font-size: clamp(16px, 2.4vw, 20px);
    }

    .final-msg.show {
      opacity: 1;
      transform: translateY(0)
    }

    /* canvases overlay */
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }

    /* small footer */
    .small {
      margin-top: 6px;
      font-size: 12px;
      opacity: 0.9;
    }

    @media (max-width:420px) {
      .wrap {
        padding: 18px
      }

      .dice {
        border-radius: 14px
      }

      .results-list {
        gap: 8px
      }

      .result-item {
        min-width: 40px;
        min-height: 40px;
        font-size: 16px
      }
    }
  </style>
</head>

<body>
  <div class="wrap" id="wrap">
    <div class="intro" id="intro">
      <h1>Ayo lempar dadu cintanya duluuu 💕</h1>
      <p>Tekan tombol <strong>ROLL DADU</strong>.</p>
    </div>

    <div class="stage" id="stage" aria-live="polite">
      <div class="dice-wrap">
        <div class="dice" id="dice">—</div>
      </div>

      <div class="controls">
        <button class="roll-btn" id="rollBtn">ROLL DADU 🎲</button>
      </div>

      <div class="caption" id="caption">Belum ada lemparan.</div>

      <div class="results-box" id="resultsBox" aria-live="polite">
        <div>Hasil:</div>
        <div class="results-list" id="resultsList" aria-hidden="false"></div>
      </div>

      <div class="final-msg" id="finalMsg"></div>

    </div>
  </div>

  <!-- canvases -->
  <canvas id="sparkle-canvas"></canvas>
  <canvas id="confetti-canvas"></canvas>

  <!-- audios (place files in same folder) -->
  <audio id="rollSound" src="roll.mp3" preload="auto"></audio>
  <audio id="loveSound" src="Chrisye - Cintaku (Lirik & Akustik Cover oleh Eclat).mp3" preload="auto"></audio>

  <script>
    // ====== Config & State ======
    const sequence = [2, 8, 9, 2, 0, 2, 5]; // fixed outputs
    let idx = 0; // how many rolls done
    const diceEl = document.getElementById('dice');
    const rollBtn = document.getElementById('rollBtn');
    const caption = document.getElementById('caption');
    const resultsList = document.getElementById('resultsList');
    const finalMsg = document.getElementById('finalMsg');
    const rollSound = document.getElementById('rollSound');
    const loveSound = document.getElementById('loveSound');

    // canvases
    const sparkleCanvas = document.getElementById('sparkle-canvas');
    const confettiCanvas = document.getElementById('confetti-canvas');
    const sCtx = sparkleCanvas.getContext('2d');
    const cCtx = confettiCanvas.getContext('2d');

    function sizeCanvases() {
      const dpr = window.devicePixelRatio || 1;
      sparkleCanvas.width = window.innerWidth * dpr;
      sparkleCanvas.height = window.innerHeight * dpr;
      sparkleCanvas.style.width = window.innerWidth + 'px';
      sparkleCanvas.style.height = window.innerHeight + 'px';

      confettiCanvas.width = window.innerWidth * dpr;
      confettiCanvas.height = window.innerHeight * dpr;
      confettiCanvas.style.width = window.innerWidth + 'px';
      confettiCanvas.style.height = window.innerHeight + 'px';

      sCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
      cCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    sizeCanvases();
    window.addEventListener('resize', sizeCanvases);

    // audio helper
    function playAudio(el) {
      if (!el) return;
      el.currentTime = 0;
      el.play().catch(() => {/* autoplay blocked; will require user gesture (we use click to play) */ });
    }

    // ===== Sparkles =====
    let sparkles = [];
    function spawnSparkles(x, y, n = 18) {
      for (let i = 0; i < n; i++) {
        sparkles.push({
          x: x + (Math.random() - 0.5) * 80,
          y: y + (Math.random() - 0.5) * 80,
          vx: (Math.random() - 0.5) * 3,
          vy: -1.5 - Math.random() * 2,
          life: 45 + Math.random() * 30,
          r: 0.6 + Math.random() * 2.6,
          hue: 260 + Math.random() * 60,
          alpha: 1
        });
      }
    }
    function drawSparkles() {
      sCtx.clearRect(0, 0, sparkleCanvas.width, sparkleCanvas.height);
      for (let i = sparkles.length - 1; i >= 0; i--) {
        const p = sparkles[i];
        p.x += p.vx; p.y += p.vy; p.vy += 0.06; p.life--;
        p.alpha = Math.max(0, p.life / 80);
        sCtx.beginPath();
        sCtx.fillStyle = `hsla(${p.hue},90%,70%,${p.alpha})`;
        sCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        sCtx.fill();
        if (p.life <= 0) sparkles.splice(i, 1);
      }
    }

    // ===== Confetti =====
    let confettis = [];
    function launchConfetti(amount = 140) {
      confettis = [];
      for (let i = 0; i < amount; i++) {
        confettis.push({
          x: Math.random() * confettiCanvas.width,
          y: -Math.random() * confettiCanvas.height,
          vx: (Math.random() - 0.5) * 5,
          vy: 2 + Math.random() * 4,
          size: 6 + Math.random() * 10,
          hue: Math.random() * 360,
          rot: Math.random() * 360,
          spin: (Math.random() - 0.5) * 6
        });
      }
      requestAnimationFrame(drawConfetti);
    }
    function drawConfetti() {
      cCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      for (let i = confettis.length - 1; i >= 0; i--) {
        const p = confettis[i];
        p.x += p.vx; p.y += p.vy; p.vy += 0.03; p.rot += p.spin;
        cCtx.save();
        cCtx.translate(p.x, p.y);
        cCtx.rotate(p.rot * Math.PI / 180);
        cCtx.fillStyle = `hsl(${p.hue} 100% 70%)`;
        cCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size * 0.6);
        cCtx.restore();
        if (p.y > confettiCanvas.height + 80) confettis.splice(i, 1);
      }
      if (confettis.length > 0) requestAnimationFrame(drawConfetti);
    }

    // ===== Dice animation & flow =====
    let flickerInterval = null;

    function animateRoll(finalValue, rollIndex, total) {
      // find center of dice to spawn sparkles
      const rect = diceEl.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      // start rolling visual
      diceEl.classList.add('rolling');
      // caption.textContent = `Rolling... (${rollIndex + 1}/${total})`;

      // play roll sound
      playAudio(rollSound);

      // flicker random numbers quickly to simulate randomness
      clearInterval(flickerInterval);
      flickerInterval = setInterval(() => {
        diceEl.textContent = Math.floor(Math.random() * 9) + 1;
      }, 80);

      // spawn sparkles while rolling
      spawnSparkles(cx, cy, 24);

      // after animation duration, set final value
      setTimeout(() => {
        clearInterval(flickerInterval);
        diceEl.textContent = finalValue;
        diceEl.classList.remove('rolling');
        spawnSparkles(cx, cy, 10);
      }, 880); // animation length aligned with CSS
    }

    function appendResult(num) {
      const item = document.createElement('div');
      item.className = 'result-item';
      item.textContent = num;
      resultsList.appendChild(item);
    }

    function showFinal() {
      // hide button
      rollBtn.disabled = true;
      rollBtn.style.display = 'none';
      caption.textContent = 'Selesai!';
      finalMsg.innerHTML = `<strong>ciee dapet angkanya itu yaa 😝</strong><div>Itu tanggal jadian kita babyyy<strong></strong> ❤️</div>`;
      finalMsg.classList.add('show');

      // confetti + love music
      launchConfetti(160);
      playAudio(loveSound);

      // extra sparkles burst
      const rect = diceEl.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;
      for (let i = 0; i < 5; i++) {
        setTimeout(() => spawnSparkles(cx, cy, 30), i * 180);
      }

      // scroll result into view (mobile friendly)
      setTimeout(() => {
        finalMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 120);
    }

    // main roll click handler
    rollBtn.addEventListener('click', () => {
      if (idx >= sequence.length) return;
      const value = sequence[idx];
      animateRoll(value, idx, sequence.length);
      // after dice settle, append result
      setTimeout(() => {
        appendResult(value);
        idx++;
        if (idx >= sequence.length) {
          // finished all rolls
          setTimeout(showFinal, 600);
        } else {
          caption.textContent = 'Siap untuk lemparan selanjutnya.';
        }
      }, 930); // a bit after animateRoll settles
    });

    // global animation tick
    function tick() {
      drawSparkles();
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    // user gesture to unlock audio on some browsers: try to unlock on first interaction
    function unlockAudioOnce() {
      // try tiny play/pause to unlock autoplay restrictions
      if (rollSound) { rollSound.play().then(() => { rollSound.pause(); rollSound.currentTime = 0; }).catch(() => { }); }
      if (loveSound) { loveSound.play().then(() => { loveSound.pause(); loveSound.currentTime = 0; }).catch(() => { }); }
      document.removeEventListener('click', unlockAudioOnce);
      document.removeEventListener('touchstart', unlockAudioOnce);
    }
    document.addEventListener('click', unlockAudioOnce);
    document.addEventListener('touchstart', unlockAudioOnce, { passive: true });

    // accessibility: show initial dice face as dash until user interacts
    window.addEventListener('DOMContentLoaded', () => {
      diceEl.textContent = '🎲';
      caption.textContent = 'Tekan "ROLL DADU" untuk mulai.';
    });

  </script>
</body>

</html>